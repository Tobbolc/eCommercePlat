{% extends 'layout_seller.html' %}
{% load static %}
{% block css %}
    <link rel="stylesheet" href="{% static 'CSS/seller_style.css' %}">
{% endblock %}
{% block content %}

    <!-- åº—é“ºå¤´éƒ¨ -->
    <header class="shop-header">
        <div class="shop-title">
            <div>
                <h1 class="shop-name">{{ shop.store_name }}</h1>
                <span class="shop-category">{{ shop.get_label_display }}</span>
            </div>
            <div class="action-bar">
                <button class="btn btn-primary" id="btnAdd">
                    ï¼‹ å‘å¸ƒæ–°å“
                </button>
            </div>
        </div>
        <div class="seller-profile">
            <p>åº—ä¸»ï¼š{{ shop.seller_name }} |
                ğŸ“å±±ä¸œçœ&nbspé’å²›å¸‚&nbspå´‚å±±åŒº&nbspæ¾å²­è·¯238å·&nbspä¸­å›½æµ·æ´‹å¤§å­¦&nbspå´‚å±±æ ¡åŒº&nbspçˆ±ç‰¹å·¥ä½œå®¤</p>
            <p>è¯¥åº—ä¸»æš‚æ— å¤‡æ³¨</p>
        </div>
    </header>

    <!-- ä¸»è¦å†…å®¹åŒº -->
    <main class="content-container">
        <!-- å•†å“å±•ç¤º -->
        <section class="product-section">
            <h2>å‘å¸ƒçš„å•†å“ï¼ˆ{{ products|length }}ï¼‰</h2>
            <div class="product-grid">
                {% for product in products %}
                    <a href="/commodity/{{ product.id }}/manage/" class="product-card">
                        <img src="{{ MEDIA_URL }}{{ product.photo }}" alt="{{ product.name }}" class="product-image">
                        <div class="product-info">
                            <h3 class="product-name">{{ product.name }}</h3>
                            <div class="product-price">Â¥{{ product.price }}</div>
                        </div>
                    </a>
                {% endfor %}
            </div>
        </section>

        <!-- è®¢å•æŸ¥çœ‹ -->
        <section class="order-section">
            <h2>å†å²è®¢å•</h2>
            <div class="order-list">
                {% for order in orders %}
                    <div class="order-item">
                        <div>
                            <div>è®¢å•å·ï¼š{{ order.oid }}</div>
                            {% if order.process_state == 1 %}
                                <div class="order-status status-shipped">
                                    {{ order.get_process_state_display }}
                                </div>
                            {% elif order.process_state == 2 %}
                                <div class="order-status status-pending">
                                    {{ order.get_process_state_display }}
                                </div>
                            {% elif order.process_state == 3 %}
                                <div class="order-status status-completed">
                                    {{ order.get_process_state_display }}
                                </div>
                            {% endif %}
                        </div>
                        <div>
                            <div class="order-amount">Â¥{{ order.price }}</div>
                            <button class="btn btn-primary"
                                    onclick="location.href='/order/{{ order.id }}/deal/'"
                                    style="margin-top:8px;padding:4px 12px;font-size:12px;">
                                å¤„ç†è®¢å•
                            </button>

                        </div>
                    </div>
                {% empty %}
                    <p>æš‚æ— è¿‘æœŸè®¢å•</p>
                {% endfor %}
            </div>
        </section>
    </main>

    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">å‘å¸ƒæ–°å“</h4>
                </div>
                <div class="modal-body">
                    <form id="formAdd">
                        <div class="clearfix">
                            {% for field in form %}
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>{{ field.label }}</label>
                                        {{ field }}
                                        <span class="error-message" style="color: red"></span>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">å– æ¶ˆ</button>
                    <button id="btnSave" type="button" class="btn btn-info">ä¿ å­˜</button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block js %}
    <script type="text/javascript">
        $(function () {
            bindBtnAddEvent();
            bindBtnSaveEvent();
        })

        function bindBtnAddEvent() {
            $("#btnAdd").click(function () {
                //ç‚¹å‡»æŒ‰é’®æ˜¾ç¤ºå¯¹è¯æ¡†
                $('#myModal').modal('show');
            });
        }


        function bindBtnSaveEvent() {
            $("#btnSave").click(function () {
                const path = window.location.pathname; // è·å–å½“å‰ URL è·¯å¾„
                //æ¸…é™¤é”™è¯¯ä¿¡æ¯
                $(".error-message").empty();
                //å‘åå°å‘é€è¯·æ±‚
                $.ajax({
                    url: "/add/commodity/",
                    type: "post",
                    data: $("#formAdd").serialize(),
                    dataType: "JSON",
                    success: function (res) {
                        if (res.status) {
                            alert("å‘å¸ƒæ–°å“æˆåŠŸï¼");
                            window.location.href = path;
                        } else {
                            $.each(res.error, function (name, errorList) {
                                $("#id_" + name).next().text(errorList[0]);
                                {#æ‹¼æ¥#}
                            })
                        }
                    }
                })
            });
        }
    </script>
{% endblock %}