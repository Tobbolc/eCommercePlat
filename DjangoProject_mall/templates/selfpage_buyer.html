{% extends 'layout_buyer.html' %}
{% load mask_filters %}
{% load static %}
{% block css %}
    <style>
        .container1 {
            background-color: #f9f9f9; /* 浅灰色背景 */
            border: 1px solid #ddd; /* 浅灰色边框 */
            border-radius: 8px; /* 圆角 */
            padding: 20px; /* 内边距 */
            max-width: 1100px; /* 最大宽度 */
            margin: 50px auto; /* 居中 */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* 柔和阴影 */
            position: relative; /* 相对定位 */
            overflow: hidden; /* 隐藏超出部分 */
        {#box-shadow: 5px 5px 20px #aaa;#}
        }

        .container1::before {
            content: '';
            position: absolute;
            top: -50px;
            right: -50px;
            width: 100px;
            height: 100px;
            background-color: rgba(0, 123, 255, 0.1); /* 蓝色点缀 */
            border-radius: 50%; /* 圆形 */
            z-index: -1; /* 置于底层 */
        }

        .container1::after {
            content: '';
            position: absolute;
            bottom: -50px;
            left: -50px;
            width: 150px;
            height: 150px;
            background-color: rgba(255, 193, 7, 0.1); /* 黄色点缀 */
            border-radius: 50%; /* 圆形 */
            z-index: -1; /* 置于底层 */
        }

        .container {
            max-width: 1200px; /* 容器最大宽度 */
            margin: 0 auto; /* 居中显示 */
            padding: 20px;
        }
    </style>
{% endblock %}

{% block content %}
    <div class="container">
        <h1><span class="glyphicon glyphicon-record"></span> {{ request.session.info_buyer.username }}的个人中心</h1>
    </div>
    <div class="container1">
        <h3>基本资料<input id="btnAdd" class="btn btn-link" type="button" value="修改信息" ></h3>
        <div style="margin-left: 10px; margin-top: 20px">
            <p class="text">用户名：<span id="username"></span>{{ user.username }}</p>
            <p class="text">密码：<span id="password"></span>{{ user.password|mask_password }}<a class="btn btn-link"
                                                                                                href="/change/pwd/">修改密码</a>
            </p>
            <p class="text">绑定的手机号：<span id="phone"></span>{{ user.phone|mask_phone }}</p>
            <p class="text">绑定的邮箱：<span id="email"></span>{{ user.email|mask_email }}</p>
            <p class="text-body">个人头像：<img style="width: 100px; height: 100px; border-radius: 20px; margin-top: 5px" src="{{ MEDIA_URL }}{{ user.avatar }}"></p>
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="file" name="avatar">
                <input type="submit" value="修改头像" class="btn btn-link">
            </form>
        </div>
        <hr>
        <h3>账户余额</h3>
        <p style="margin-left: 10px; margin-top: 20px">{{ user.username }}的钱包余额: {{ user.account|floatformat:2 }}<input id="btn0" class="btn btn-link" type="button" value="充值">
        </p>
        <hr>
        <h3>购物车</h3>
        <p style="margin-left: 10px; margin-top: 20px">点击此处跳转到我的购物车<a class="btn btn-link" href="/index/cart/">购物车</a></p>
        <hr>
        <h3>历史订单</h3>
        <p style="margin-left: 10px; margin-top: 20px">点击此处查看历史订单<a class="btn btn-link" href="/order/history/">历史订单</a></p>

    </div>
    <!-- 修改信息 -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">修改信息</h4>
                </div>
                <div class="modal-body">
                    <form id="formAdd">
                        <div class="clearfix">
                            {% for field in form %}
                                <div class="col-md-12">
                                <div class="form-group">
                                    <label>{{ field.label }}</label>
                                    {{ field }}
                                    <span class="error-message" style="color: red"></span>
                                </div>
                                </div>
                            {% endfor %}
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">取 消</button>
                    <button id="btnSave" type="button" class="btn btn-info">保 存</button>
                </div>
            </div>
        </div>
    </div>
    <!-- 充值 -->
    <div class="modal fade" id="myModal1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">修改信息</h4>
                    </div>
                    <div class="modal-body">
                        <form id="form1">
                            <div class="clearfix">
                                {% for field in form1 %}
                                    <div class="col-md-12">
                                    <div class="form-group">
                                        <label>{{ field.label }}</label>
                                        {{ field }}
                                        <span class="error-message" style="color: red"></span>
                                    </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">取 消</button>
                        <button id="btn1" type="button" class="btn btn-info">保 存</button>
                    </div>
                </div>
            </div>
        </div>
{% endblock %}
{% block js %}
    <script type="text/javascript">
        $(function (){
            bindBtnAddEvent();
            bindBtnSaveEvent();
            bindBtn0Event();
            bindBtn1Event();
        })

        function bindBtnAddEvent(){
            $("#btnAdd").click(function (){
               //点击按钮显示对话框
                $('#myModal').modal('show');
            });
        }
        function bindBtn0Event(){
            $("#btn0").click(function (){
               //点击按钮显示对话框
                $('#myModal1').modal('show');
            });
        }

        function bindBtnSaveEvent(){
            $("#btnSave").click(function (){
                const path = window.location.pathname; // 获取当前 URL 路径
                //清除错误信息
                $(".error-message").empty();
                //向后台发送请求
               $.ajax({
                   url: "/changeinfo/buyer/",
                   type: "post",
                   data: $("#formAdd").serialize(),
                   dataType: "JSON",
                   success: function (res) {
                       if (res.status){
                           alert("修改成功");
                           window.location.href = path;
                       }else{
                           $.each(res.error, function (name, errorList){
                               $("#id_"+name).next().text(errorList[0]);
                               {#拼接#}
                           })
                       }
                   }
               })
            });
        }
        function bindBtn1Event(){
            $("#btn1").click(function (){
                const path = window.location.pathname; // 获取当前 URL 路径
                //向后台发送请求
               $.ajax({
                   url: "/accountadd/buyer/",
                   type: "post",
                   data: $("#form1").serialize(),
                   success: function (res) {
                       if (res.status){
                           alert("充值成功");
                           window.location.href = path;
                       }
                   }
               })
            });
        }
    </script>
{% endblock %}
